<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tuture.model.dao.BoardDao">

    <select id="getBoardList"
            resultType="Board">
        SELECT * FROM board
    </select>

    <insert id="insertBoard"
            parameterType="Board">
        INSERT INTO board (id, writer_id, writer_nickname, title, reg_date, view_cnt, content, region, due_date,
        role_category, img_url)
        VALUES (#{id}, #{writer_id}, #{writer_nickname}, #{title}, #{reg_date}, #{view_cnt}, #{content}, #{region},
        #{due_date}, #{role_category}, #{img_url})
    </insert>

    <update id="updateBoard"
            parameterType="Board">
        UPDATE board
        SET title = #{title}, reg_date = #{reg_date}, content = #{content}, region = #{region}, due_date = #{due_date},
        role_category = #{role_category}, img_url = #{img_url}
        WHERE id = #{id}
    </update>

    <delete id="deleteBoard" parameterType="Long">
        DELETE board
        WHERE id = #{id}
    </delete>

    <select id="search" parameterType="SearchCondition" resultType="Board">
        SELECT * FROM board
        <if test="key != 'none'">
            WHERE ${key} like concat('%', #{word}, '%')
        </if>
    </select>

    <select id="findBoardsByTags" resultType="Board">
        SELECT DISTINCT Board.*
        FROM board
        JOIN boardTags ON board.id = boardTagDto.id
        JOIN Tags ON boardTags.tagId = TagDto.tagId
        WHERE Tags.name IN
        <foreach item="tag" collection="tags" open="(" separator="," close=")">
            #{tag}
        </foreach>
    </select>
</mapper>